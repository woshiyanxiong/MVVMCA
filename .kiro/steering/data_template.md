---
inclusion: manual
---

# 概述

1. data:data_template 模块展示了数据层代码应该怎么写，是为了辅助AI生成数据层代码，新生成的数据层代码应参照该模块代码。

2. 该模块中的类都添加了注释，需要仔细阅读


# 目录结构说明

1. com.yupao.data.data_template.di目录用来放用于注册Hilt的类

2. com.yupao.data.data_template.entity目录用来放数据层的实体，这些实体包括本地实体，网络实体，参数实体。注意业务实体不放这，业务实体在对应的model模块中

3. com.yupao.data.data_template.lds目录用来放本地数据来源相关的类

4. com.yupao.data.data_template.rds目录用来放远程数据来源相关的类

5. com.yupao.data.data_template.rep目录用来放仓库相关的类

6. 数据层中的类默认都需要用internal修饰表明是模块访问级别的，只有仓库接口类，网络实体，参数实体是public的，网络实体也是public的原因是有一部分代码会把网络实体直接当作业务实体，这个是允许的。


# 实体说明

## 实体分类

1. 在项目中一共有网络实体、本地存储实体、业务实体、参数实体。所有的实体都使用data class，都需要用@Keep修饰

## 网络实体

1. 网络实体用于对接口返回数据进行反序列化时使用

2. 网络实体都需要继承BaseData基类

3. 网络实体存放在data模块中

## 本地存储实体

1. 本地存储实体存放在data模块使用，需要使用internal修饰

## 参数实体

1. 参数实体在UI层跟数据层都可能定义，在data模块中的参数实体主要用于请求数据时使用

## 业务实体

1. 务实体定义在跟data模块同名的model模块中，不要将业务实体定义在data模块中。

## 注意事项

1. 由于本地存储实体和网络实体涉及到从外部系统进行序列化和反序列化操作，因此本地存储实体和网络实体中的字段都为可空。

# 仓库注意事项

1. 其他模块只能通过data模块的仓库来获取数据，因此仓库是data模块中唯一对外暴露的用来获取或修改数据的类

2. 仓库返回的数据实体可以是网络实体，也可以是业务实体，按照规范来将应只返回业务实体，但由于历史代码中很多是人工写的，多一道转换过程会比较繁琐，就存在直接返回网络实体的情况了。现在若无特殊要求，就返回网络实体即可。

3. 仓库中获取数据需要区分是一次性还是持续监听的:

   1. 如果是一次性的，方法名以get为前缀，返回类型为Flow<Resource<T>>，其中T为具体的实体类

   2. 如果是持续监听的，方法名以listen为前缀，返回类型为Flow<T?>，其中T为具体的实体类，?代表可空。持续监听的数据只能是存在本地的数据，通过本地数据来源(LDS)来获取


# 远程数据来源

1. 远程数据源(RDS)，封装了通过调用后端接口来获取数据的过程


# 本地数据来源

1. 本地数据源(LDS)，封装了从本地存储中获取数据的过程

2. 项目中存储和读取本地数据的方式有三种：

   1. 使用封装的MMKV工具来实现轻量级键值对数据存储，特点是快，但无法实现监听功能

   2. 使用封装的DataStore工具来实现轻量级键值对数据存储，可以实现监听功能

   3. 使用ROOM来实现数据库式的数据管理

3. 注意在存储键值对时，如果需要监听或者说持续监听功能则必须选择DataStore来存储，而不能选择KV来存储。如果不要求持续监听的话，则直接默认使用KV工具来存储即可。

4. 同样的数据不要同时用多个工具来存，选择了DataStore来存就不要再用MMKV来存，选择了MMKV来存就不要再用DataStore来存。

5. DataStore和KV都只能存储基本数据类型和String，其他数据类型需要通过GsonUtil工具序列化成string来存储，读取的时候再通过GsonUtil工具反序列化map转换成对应的实体

6. DataStore类需要添加@Keep修饰
