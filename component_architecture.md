# 组件化架构设计

## 什么是组件化？

到底什么是组件化呢？很多人都回答到一个东西'独立编译'，这个东西到底好用不好用。多少场景能用的到？特别是在需要登陆状态的时候。我想用过的都知道这个到底适合在什么样的应用场景，这里不在拓展了。

## 组件化面临的核心问题

组件化一定会面临的一个问题。那就是各个组件如何通信？我想一定遇到过这样的场景A业务块下面有个弹框。过了一段时间B业务快也需要使用这个弹框。那么这个时候一般是怎么做的？下层到公共模块里面比如common包。如果这个弹框还涉及到接口与关联的业务逻辑，那么相关的也得下层。久而久之这个common是不是就变味有点不对劲？

### 解决方案：接口通信

那怎么通信呢？很简单通过接口通信，在直白一点就是为每个业务块开放一个api 只提供对外接口和实体。实现在业务快里面。这个操作通过ARouter 或者dagger 来实现。

## 组件划分原则

另一方面组件划分问题，也就是边界值。分好了是组件 分不好就是模块，大多数情况下组件的划分为：

### 基础组件化结构

```
MyApp/
├── app/                       # 主工程，一个空的"壳"
│   └── 主要职责：集成所有组件，初始化全局配置（如路由）
├── module_home/              # 首页组件（可独立运行）
├── module_video/             # 视频组件（可独立运行）
├── module_shopping/          # 商城组件（可独立运行）
├── module_user/              # 用户中心组件（可独立运行）
├── library_base/             # 基础组件
│   ├── 基类（BaseActivity, BaseFragment）
│   ├── 通用工具类（ToastUtils, LogUtils）
│   └── 公共资源（colors, dimens）
└── library_common/           # 公共业务组件
    ├── 网络请求封装
    ├── 图片加载封装
    ├── 路由 SDK 的封装和配置
    └── 第三方 SDK 的统一管理
```

## 数据层的重要性

其余我们还需要很重要的模块那就是数据data层。业务组件（如 feature_home）不关心数据来自网络、数据库还是缓存。它只通过 Repository 获取数据。Repository 决定从哪里获取数据以及如何缓存，同时每个业务线的数据独立。其他业务线需要引用只需要引用对于的data模块就行。

### 完整的组件化架构

```
MyApp/
├── app/                       # 主工程/壳工程
│   └── 职责：集成所有组件，初始化全局配置（路由、AppContext等）
│
├── feature_home/              # 首页业务组件（可独立运行）
├── feature_video/             # 视频业务组件（可独立运行）
├── feature_shopping/          # 商城业务组件（可独立运行）
│
├── library_base/              # 基础组件
│   ├── 基类（BaseActivity, BaseFragment）
│   ├── 通用工具类（ToastUtils, LogUtils）
│   └── 公共资源（colors, dimens）
│
├── library_common/            # 公共业务组件
│   ├── 网络请求封装
│   ├── 图片加载封装
│   └── 路由 SDK 的封装和配置
│
└── data/                      # 数据层（核心新增）
    ├── repository/            # 仓库层
    │   ├── HomeRepository.java
    │   ├── VideoRepository.java
    │   └── ... (实现接口，合并本地和远程数据源)
    │
    ├── model/                 # 模型层/实体层
    │   ├── api/               # 网络接口返回的数据模型
    │   ├── db/                # 数据库对应的数据模型
    │   └── ui/                # UI 层使用的数据模型（可选，可与 api/db 不同）
    │
    ├── source/                # 数据源层
    │   ├── remote/            # 远程数据源
    │   │   ├── api/           # Retrofit 接口定义
    │   │   └── response/      # 网络响应模型
    │   └── local/             # 本地数据源
    │       ├── db/            # Room 数据库相关
    │       └── preferences/   # SharedPreferences 管理
    │
    └── datasource/            # （可选）数据源接口模块
        ├── IHomeDataSource.java
        └── ... (定义接口，供业务组件依赖，实现解耦)
```

## 组件化架构优势

### 1. 职责清晰
- **业务组件**：专注于具体业务逻辑和UI实现
- **数据层**：统一管理数据获取、缓存和存储
- **基础组件**：提供通用功能和工具

### 2. 独立开发
- 各业务组件可以独立编译和运行
- 团队可以并行开发不同模块
- 降低模块间的耦合度

### 3. 易于维护
- 数据逻辑集中管理，便于统一维护
- 接口化通信，降低组件间依赖
- 清晰的模块边界，便于问题定位

### 4. 可扩展性
- 新增业务组件不影响现有模块
- 数据层支持多种数据源扩展
- 基础组件可复用于多个项目